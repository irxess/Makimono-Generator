{% extends 'base.html' %}
{% block title %}{{ r.name }} Recipe{% endblock %}
{% block meta_description %}{{ r.description }}{% endblock %}

{% block content %}
<main id="content">

  <section id="intro">
    <h1>{{ r.name }}</h1>

   {% if (r.description is defined) and r.description %}
    <p id="flavor-text">
      {{ r.description }}
    </p>
    {% endif %}

    {% if (r.image is defined) and r.image %}
        <img src="{{path_to_base}}/images/{{ r.image }}" alt="">
    {% endif %}
  </section>

  {% if r.date_updated != '' and r.date_updated != r.date_created %}
  <p class="recipe-date">
      Created on {{ r.date_created }}</br>
      Last updated on {{ r.date_updated }}
  </p>
  {% else %}
  <p class="recipe-date">Created on {{ r.date_created }}</p>
  {% endif %}

  <section id="ingredients">
    <h2>Ingredients</h2>
    <hr>
    <div id="ingredients-table">
      <table>
        {% for ingredient in r.ingredients %}
          <tr>
            <td class="amount" data-original-amount="{{ingredient.total_amount}}" >
              {% if ingredient.total_amount %}
                {{ingredient.total_amount}}
              {% endif %}
            </td>
            <td class="unit">
              {% if ingredient.unit %}
                {{ingredient.unit}}
              {% endif %}
            </td>
            <td class="name">{{ingredient.name}}</td>
            {% if ingredient.comment %}
              <td class="comment">{{ingredient.comment}}</td>
            {% endif %}
          </tr>
        {% endfor %}
      </table>
    </div>
  </section>

  <section id="scaling">
    <h2>Scaling</h2>
    <form>
      <button type="button" id="reset-button" onclick="resetScaling()">Reset</button>
      <fieldset name="percent">
        <label for="percent">Percent</label>
        <input type="number" name="percent" min="0" step="any" value="100" oninput="scaleByPercentNumber()">%
        <input type="range" name="percent" value="100" min="10" max="1000" step="5" oninput="scaleByPercentSlider()">
      </fieldset>
      <fieldset name="ingredient">
        <label for="ingredient">By ingredient</label>
        <select name="ingredient">
          {% for ingredient in r.ingredients %}
            {% if ingredient.total_amount %}
              <option value="{{ingredient.name}}">
                {{ingredient.name}}
                {% if ingredient.unit %}
                  ({{ingredient.unit}})
                {% endif %}
              </option>
            {% endif %}
          {% endfor %}
        </select>
        amount:
        <input type="number" name="ingredient">
        <button type="button" onclick="scaleByIngredient()">Scale</button>
      </fieldset>
    </form>
  </section>

  <section id="timeline">
    {% if (r.timeline is defined) %}
      {% include 'timeline.html' %}
    {% endif %}
  </section>

  <section id="steps">
    <h2>Directions</h2>
    {% for s in r.steps %}
    <hr>
    <div class="step">
      {% if s.ingredients_used %}
      <div class="ingredient-container">
        <div class="step-ingredient-list">
            <ul>
              {% for i in s.ingredients_used %}
                <li>
                  <b>
                    {% if i.amount %}
                      <span class="amount" data-original-amount="{{ i.amount }}">{{ i.amount }}</span>
                    {% endif %}
                    {{i.unit}}
                  </b>
                  {{ i.name }}
                </li>
              {% endfor %}
            </ul>
        </div>
      </div>
      {% endif %}
      <div class="description-container">
        <div class="step-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2em 2em" height="2em" width="2em">
            <circle class="{{ s.temperature }}" cx="1em" cy="1em" r="1em" />
            <image class="svg-icon" xlink:href="{{path_to_base}}/images/icons/{{ s.step_type }}-light.svg"
                   x="0.25em" y="0.25em"
                   width="1.5em" height="1.5em" />
          </svg>
        </div>
        <div class="step-description">
            <b>{{ s.short }}{% if s.long %}: {% endif %}</b>
            {{ s.long }}
        </div>
      </div>
    </div>
    {% endfor %}
  </section>

</main>
{% endblock %}
